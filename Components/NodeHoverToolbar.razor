@using MiniWorkflowBuilder.Models

<div class="absolute -top-12 left-1/2 transform -translate-x-1/2 bg-white border border-gray-200 rounded-lg shadow-lg p-1 flex gap-1 z-50">

    <button class="p-2 text-gray-600 hover:bg-gray-100 hover:text-green-600 rounded transition-colors"
            @onclick="RunNode" title="Run">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h1m4 0h1m6-10V5a2 2 0 00-2-2H6a2 2 0 00-2 2v14a2 2 0 002 2h8l6-6V9a2 2 0 00-2-2h-2z"></path>
        </svg>
    </button>

    <button class="p-2 text-gray-600 hover:bg-gray-100 hover:text-blue-600 rounded transition-colors"
            @onclick="DuplicateNode" title="Duplicate">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
        </svg>
    </button>

    <button class="p-2 text-gray-600 hover:bg-gray-100 hover:text-red-600 rounded transition-colors"
            @onclick="DeleteNode" title="Delete">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
        </svg>
    </button>

    <div class="relative">
        <button class="p-2 text-gray-600 hover:bg-gray-100 rounded transition-colors"
                @onclick="ToggleMore" title="More">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"></path>
            </svg>
        </button>

        @if (_showMore)
        {
            <div class="absolute top-full left-0 mt-1 w-48 bg-white border border-gray-200 rounded-lg shadow-lg py-1 z-60">
                <button class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50" @onclick="Rename">
                    Rename
                </button>
                <button class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50" @onclick="ConfigureRunAfter">
                    Configure run after
                </button>
                <button class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50" @onclick="ConfigureContext">
                    Configure context
                </button>
            </div>
        }
    </div>
</div>

@code {
    [Parameter] public BaseNode Node { get; set; } = null!;
    [Parameter] public EventCallback<BaseNode> OnNodeDeleted { get; set; }
    [Parameter] public EventCallback<BaseNode> OnNodeDuplicated { get; set; }

    private bool _showMore = false;

    private void RunNode()
    {
        Console.WriteLine($"Running node: {Node.Title}");
    }

    private void DuplicateNode()
    {
        OnNodeDuplicated.InvokeAsync(Node);
    }

    private void DeleteNode()
    {
        OnNodeDeleted.InvokeAsync(Node);
    }

    private void ToggleMore()
    {
        _showMore = !_showMore;
    }

    private void Rename()
    {
        _showMore = false;
    }

    private void ConfigureRunAfter()
    {
        _showMore = false;
    }

    private void ConfigureContext()
    {
        _showMore = false;
    }
}
